不容易花了好几天终于完成,服务器框架主要是主线程监听套接字,然后将accept得到的套接字传递给子线程(直接加入子线程监听队列中,省去了传递数据抢锁等等)每个子线程也使用epoll监听事件  
即主线程epoll+n个子线程epoll,(参考博主 https://shafeng.github.io/2015/09/02/epoll_2/  介绍的常用五种框架)
难点主要在多路复用代码这块,(感觉多路复用的意义是解决 数据在网络中传输远远小于数据处理时间的 说白了传输1000字节的时间远远大于一个程序操作1000字节的时间,所以当阻塞型io实际浪费了cpu分配的时间片空等数据,不如把这个时间交给其他人使用,而且每次只读写一点立刻返回不能全部写完否则就无法形成并发了,比如处理大文件... )代码写成通用性,另外由于每次只读写一个包,下次的读写如果在上次基础上那么需要定义额外数据结构保存相关息,如本项目中的每次fread的偏移量,下次继续读取  

流程图如下
![image](https://github.com/yfabc123/my_project/assets/103840107/5854dd76-b065-40f9-89c8-6f85e1df35b6)

做项目时的思维导图:  
![tcp文件上传工具项目思维导图](https://github.com/yfabc123/my_project/assets/103840107/7557a746-0743-4517-b021-d8bbab9991e8)
  
几个注意点:  
1.关闭了一个空文件流导致 →由于文件名不存在→粘包问题处理不当导致,在循环中初始化了…..一个下午加一个晚上,丢  
2.上传文件死循环了,一直在发送给客户端?每次读取后需要更新哈希表的偏移量  
3.服务器发送,客户端写入两边一致但是最终文件总是少一点,最后才想起来是数据在缓冲区 没有显示调用关闭文件 和fllush强刷缓冲区导致定位一下午,   
4.并发测试:4个10MB可执行文件同时下载和上传给服务器 下载文件缺失一部分  
问题1:打印的信息显示两边发送(fread)接收(fwrite)数据内容字节数一致时文件还是缺失  
问题2:fopen 有好几次报这种错 fopen  Bad address 或者  Permission denied  
解决:fopen 用二进制格式打开 ,同时 把vscode 远程可视化工具 还有windows共享目录窗口全部关闭  
5.解决了vscode一大尴尬之处-在自动补全的代码中写没有提示 这个问题(bingAI牛皮)有时候不是找不到答案而是问题描述就不对, 如果知道这叫活动代码块不提示,这个问题早就搜到了吧 
![image](https://github.com/yfabc123/my_project/assets/103840107/50ad1c64-1142-4421-abe0-cbd11fcf6261)

![image](https://github.com/yfabc123/my_project/assets/103840107/1ad6e6a2-af09-4a89-9969-4eae55ab82c2)
6.为了解决粘包问题直接采用发送接收数据都固定长度比较稳,另外如果是二进制数据 数据包中需要包含一个记录长度(也就是fread/read之后的size) ,统计二进制数据长度没有意义本身就包含空格  
7.EPOLL_CTL_DEL调用要在close之后 否则会报错  

最后 日拱一卒-功不唐捐!加油
